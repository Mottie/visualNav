/*!
 * Visual Navigation (visualNav) v2.4
 * https://github.com/Mottie/visualNav/wiki
 * by Rob Garrison (Mottie)
 * MIT licensed.
 */
(function(a){a.visualNav=function(c,b){var e,d=this;d.$el=a(c);d.$el.data("visualNav",d);d.init=function(){d.initialized=false;d.options=e=a.extend({},a.visualNav.defaultOptions,b);d.win=window;d.$win=a(d.win);d.$doc=a(document);var f,g="html, body";a("html, body").each(function(){var i=a(this);var h=i.scrollTop();i.scrollTop(h+1);if(i.scrollTop()===h+1){g=this.nodeName.toLowerCase();i.scrollTop(h);return false}});d.$body=a(g);d.$lastItem=[null];a.each(e.easing,function(j,h){if(!a.isFunction(a.easing[h])){e.easing[j]="swing"}});if(e.stopOnInteraction){d.$body.bind("scroll mousedown DOMMouseScroll mousewheel keyup",function(h){if(h.which>0||h.type==="mousedown"||h.type==="mousewheel"){d.$body.stop()}})}d.$win.bind("scroll resize",function(){d.throttle()});d.update();if(e.useHash&&d.win.location.hash){d.animate(d.win.location.hash)}d.findLocation();f="."+e.selectedClass+(e.selectedAppliedTo===e.link?"":" "+e.link);d.$el.find(f).trigger("click.visualNav",true)};d.update=function(){d.$content=a("."+e.contentClass);d.leftMargin=parseInt(d.$content.css("margin-left"),10);d.rightMargin=parseInt(d.$content.css("margin-right"),10);var h,g=e.selectedAppliedTo+(e.selectedAppliedTo===e.link?"":" "+e.link),f="."+e.externalLinks;d.$links=a(d.$el.find(g).map(function(j,k){h=a(k);return(!h.hasClass(f)&&!h.closest(f).length)?k:null}));f="."+e.contentLinks;d.$links.add(a(f+","+f+" a")).unbind("click.visualNav").bind("click.visualNav",function(j,i){d.animate(a(this).attr(e.targetAttr)||a(this).attr("href"),i);return false});d.$items=(e.selectedAppliedTo===e.link)?d.$links:a(d.$links.map(function(){return a(this).closest(e.selectedAppliedTo)[0]}));if(d.initialized){d.findLocation()}};d.animate=function(g,f){if(g!=="#"&&a(g).length){var h=a(g).eq(0).closest("."+e.contentClass);if(h.length){d.curHash=h[0].id||"";d.$curContent=h;if(d.initialized&&typeof e.beforeAnimation==="function"){e.beforeAnimation(d,h)}d.$body.stop().animate({scrollLeft:Math.min(h.offset().left,d.$doc.width()-d.$win.width())-d.leftMargin,scrollTop:Math.min(h.offset().top,d.$doc.height()-d.$win.height())},{queue:false,duration:d.initialized?e.animationTime:0,easing:e.easing[0],specialEasing:{scrollLeft:e.easing[0]||"swing",scrollTop:e.easing[1]||e.easing[0]||"swing"},complete:function(){d.completed(f)}})}}};d.throttle=function(){if(d.flag){return}d.flag=true;d.timer=setTimeout(function(){d.flag=false;d.findLocation()},100)};d.completed=function(f){if(e.useHash){d.win.location.hash=d.curHash}if(d.initialized){if(typeof e.complete==="function"){e.complete(d,d.$curContent)}}else{if(f){if(typeof e.initialized==="function"){e.initialized(d,d.$curContent)}d.initialized=true}}d.flag=false};d.findLocation=function(){var l,o,i,f,m,k,q,n,g=d.$win.width(),p=d.$win.scrollLeft(),h=d.$win.scrollTop(),s=p+g,j=h+d.$win.height(),r=d.$doc.height();d.$items.removeClass(e.inViewClass);if(e.fitContent){d.$content.width(g-d.leftMargin-d.rightMargin)}d.$links.each(function(t){f=a(this).attr(e.targetAttr);l=(f==="#"||f.length<=1)?"":a(f);if(l.length){i=Math.ceil(l.offset().top);o=Math.ceil(l.offset().left);k=l.outerHeight();m=i+k+e.bottomMargin;q=l.outerWidth();n=o+q;if(i<j&&(i+k-e.bottomMargin>h||m>j)&&o<s&&(o+q-e.bottomMargin>p||n>s)){d.$items.eq(t).addClass(e.inViewClass)}}});f=(j+e.bottomMargin>=r)?":last":":first";d.$items.removeClass(e.selectedClass);d.$curItem=d.$items.filter("."+e.inViewClass+f).addClass(e.selectedClass);if(d.$curItem[0]!==d.$lastItem[0]){d.$lastItem=d.$curItem;d.$content.removeClass(e.currentContent);f=a("."+e.selectedClass+(e.selectedAppliedTo===e.link?"":" "+e.link)).attr(e.targetAttr);d.$curContent=a(f).closest("."+e.contentClass).addClass(e.currentContent);if(d.initialized&&typeof e.changed==="function"){e.changed(d,d.$curContent)}}};d.init()};a.visualNav.defaultOptions={link:"a",targetAttr:"href",selectedAppliedTo:"li",contentClass:"content",contentLinks:"visualNav",externalLinks:"external",useHash:true,inViewClass:"inView",selectedClass:"selected",currentContent:"current",bottomMargin:100,fitContent:false,animationTime:1200,easing:["swing","swing"],stopOnInteraction:true,initialized:null,beforeAnimation:null,complete:null,changed:null};a.fn.visualNav=function(b){return this.each(function(){var c=a(this).data("visualNav");if((typeof(b)).match("object|undefined")){if(!c){(new a.visualNav(this,b))}else{c.update()}}else{if(typeof b==="string"&&/^(#|\.)/.test(b)){c.animate(b)}}})};a.fn.getvisualNav=function(){return this.data("visualNav")}})(jQuery);
